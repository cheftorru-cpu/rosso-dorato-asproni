<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rosso Dorato â€“ Gestionale</title>
<style>
body{font-family:Arial;background:#f6f6f6;padding:15px}
h1,h2,h3{color:#8b0000}
.box{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
input{width:100%;padding:8px;margin-top:6px}
button{width:100%;padding:10px;margin-top:8px;font-size:16px;border:none;border-radius:6px}
.salva{background:#8b0000;color:#fff}
.chiudi{background:#000;color:#fff}
.item{background:#eee;padding:6px;margin-top:5px;border-radius:4px}
.mese{background:#ddd;padding:8px;margin-top:10px;border-radius:6px}
.giorno{background:#fafafa;padding:6px;margin-top:5px;border-radius:4px}
</style>
</head>

<body>

<h1>Rosso Dorato â€“ Gestionale</h1>

ðŸ“… Data:
<input type="date" id="data">

<div class="box">
<h3>Incassi</h3>
<input id="contanti" type="number" placeholder="Contanti">
<input id="pos" type="number" placeholder="POS">
<input id="satis" type="number" placeholder="Satispay">
</div>

<div class="box">
<h3>Spese</h3>
<input id="food" type="number" placeholder="Spesa Food">
<input id="forFood" placeholder="Fornitore Food">
<input id="nonfood" type="number" placeholder="Spesa Non Food">
<input id="forNon" placeholder="Fornitore Non Food">
<input id="personale" type="number" placeholder="Extra personale">
</div>

<button class="salva" onclick="salva()">ðŸ’¾ Salva giornata</button>
<button class="chiudi" onclick="chiudiMese()">ðŸŸ¥ Chiudi mese</button>

<div class="box">
<h3>Mese corrente</h3>
Incassi: <span id="inc">0</span> â‚¬<br>
Spese: <span id="spe">0</span> â‚¬<br>
Utile: <span id="uti">0</span> â‚¬
</div>

<div class="box">
<h2>ðŸ“Š Storico mesi</h2>
<div id="storico"></div>
</div>

<script>
document.getElementById("data").value=new Date().toISOString().split("T")[0];

let giorni=JSON.parse(localStorage.getItem("giorni"))||[];
let mesi=JSON.parse(localStorage.getItem("mesi"))||[];

function salva(){
 let d=new Date(data.value).toLocaleDateString("it-IT");
 if(giorni.some(g=>g.data===d)){alert("Data giÃ  inserita");return;}

 let c=+contanti.value||0;
 let p=+pos.value||0;
 let s=+satis.value||0;
 let inc=c+p+s;

 let f=+food.value||0;
 let nf=+nonfood.value||0;
 let pers=+personale.value||0;
 let spe=f+nf+pers;

 giorni.push({
  data:d,
  incassi:{c,p,s},
  food:{v:f,f:forFood.value},
  nonfood:{v:nf,f:forNon.value},
  personale:pers,
  totaleInc:inc,
  totaleSpe:spe,
  utile:inc-spe
 });
 localStorage.setItem("giorni",JSON.stringify(giorni));
 aggiorna();
}

function chiudiMese(){
 if(!confirm("Chiudere il mese e salvare nello storico?"))return;

 let meseNome=new Date().toISOString().slice(0,7);
 mesi.push({mese:meseNome,giorni:[...giorni]});
 localStorage.setItem("mesi",JSON.stringify(mesi));

 giorni=[];
 localStorage.setItem("giorni","[]");
 aggiorna();
}

function aggiorna(){
 let inc=0,spe=0,uti=0;
 giorni.forEach(g=>{
  inc+=g.totaleInc;
  spe+=g.totaleSpe;
  uti+=g.utile;
 });
 document.getElementById("inc").innerText=inc;
 document.getElementById("spe").innerText=spe;
 document.getElementById("uti").innerText=uti;

 let h="";
 mesi.slice().reverse().forEach((m,i)=>{
  h+=`<div class="mese" onclick="toggle(${i})">
       â–¶ ${m.mese}
       <div id="m${i}" style="display:none">`;
  m.giorni.forEach(g=>{
   h+=`<div class="giorno">
        <strong>${g.data}</strong><br>
        Incassi: ${g.totaleInc} â‚¬<br>
        Spese: ${g.totaleSpe} â‚¬<br>
        Utile: ${g.utile} â‚¬
       </div>`;
  });
  h+=`</div></div>`;
 });
 document.getElementById("storico").innerHTML=h||"Nessun mese chiuso";
}

function toggle(i){
 let el=document.getElementById("m"+i);
 el.style.display=el.style.display==="none"?"block":"none";
}

aggiorna();
</script>

</body>
</html>
