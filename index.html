<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Rosso Dorato Asproni</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#111;color:#eee;font-family:system-ui,Arial;padding:15px}
h1{text-align:center;margin-bottom:20px}
.card{background:#1c1c1c;border-radius:12px;padding:15px;margin-bottom:15px}
input,select,button{width:100%;padding:10px;margin:6px 0;border:none;border-radius:8px}
button{background:#b11218;color:#fff;font-weight:600}
button.secondary{background:#333}
.month-card,.day-card{border:1px solid #333;border-radius:10px;margin-bottom:10px;overflow:hidden}
.month-header,.day-header{padding:10px;cursor:pointer;background:#222;display:flex;justify-content:space-between}
.month-body,.day-body{display:none;padding:10px}
.trash{background:#333;border:none;border-radius:6px;padding:4px 8px;font-size:12px}
.small{font-size:14px;color:#bbb}
.modal{display:none;position:fixed;inset:0;background:rgba(0,0,0,.7);justify-content:center;align-items:center}
.modal-box{background:#1c1c1c;width:90%;max-width:420px;padding:15px;border-radius:12px}
.list-item{display:flex;justify-content:space-between;font-size:14px;margin-top:4px}
.sep{margin-top:8px;border-top:1px dashed #444;padding-top:6px}
</style>
</head>

<body>
<h1>üç∑ Rosso Dorato Asproni</h1>

<div class="card">
<h2>Nuova giornata</h2>
<input type="date" id="data">
<input type="number" id="incC" placeholder="Incassi contanti">
<input type="number" id="incP" placeholder="Incassi POS">
<input type="number" id="incS" placeholder="Sardex">
<button onclick="openModal('food')">‚ûï Spesa Food</button>
<button onclick="openModal('nonfood')">‚ûï Spesa Non Food</button>
<button onclick="openModal('extra')">‚ûï Extra</button>
<button onclick="openModal('acconti')">‚ûï Acconto Personale</button>
<button onclick="salva()">üíæ Salva Giornata</button>
</div>

<div class="card">
<h2>Storico</h2>
<div id="storico"></div>
</div>

<div class="modal" id="modal">
<div class="modal-box">
<h3 id="modTit"></h3>
<input type="number" id="mImporto" placeholder="Importo">
<input type="text" id="mNome" placeholder="Nome / Fornitore / Personale">
<select id="mPag">
<option>Contanti</option>
<option>POS</option>
<option>Bonifico</option>
</select>
<button onclick="addVoce()">Aggiungi</button>
<div id="lista"></div>
<button class="secondary" onclick="closeModal()">Chiudi</button>
</div>
</div>

<script>
let db=JSON.parse(localStorage.getItem("rd"))||{};
let buffer={food:[],nonfood:[],extra:[],acconti:[]};
let tipo="";

function openModal(t){tipo=t;modTit.innerText="Aggiungi "+t;modal.style.display="flex";render()}
function closeModal(){modal.style.display="none"}
function addVoce(){
  if(+mImporto.value<=0) return;
  buffer[tipo].push({i:+mImporto.value,n:mNome.value,p:mPag.value});
  mImporto.value="";mNome.value="";render();
}
function render(){
  lista.innerHTML="";
  buffer[tipo].forEach((v,i)=>{
    lista.innerHTML+=`<div class="list-item">
      <span>‚Ç¨${v.i} - ${v.n}</span>
      <span onclick="buffer[tipo].splice(${i},1);render()">‚ùå</span>
    </div>`;
  });
}

function salva(){
  if(!data.value) return alert("Inserisci la data");
  let m=data.value.slice(0,7);
  if(!db[m]) db[m]=[];
  db[m].push({
    data:data.value,
    inc:+incC.value+ +incP.value+ +incS.value,
    food:[...buffer.food],
    nonfood:[...buffer.nonfood],
    extra:[...buffer.extra],
    acconti:[...buffer.acconti]
  });
  localStorage.setItem("rd",JSON.stringify(db));
  buffer={food:[],nonfood:[],extra:[],acconti:[]};
  mostraStorico();
}

function toggle(el){el.style.display=el.style.display==="block"?"none":"block"}

function blocco(tit,arr){
  let tot=0,html="";
  arr.forEach(v=>{tot+=v.i;html+=`<div class="list-item">‚Ç¨${v.i} - ${v.n}</div>`});
  return `<div class="sep"><strong>${tit} ‚Ç¨${tot}</strong>${html}</div>`;
}

function mostraStorico(){
  let html="";
  Object.keys(db).sort().reverse().forEach((m,mi)=>{
    let inc=0,spF=0,spN=0,spE=0,acc=0,days="";
    db[m].forEach((g,i)=>{
      g.food.forEach(x=>spF+=x.i);
      g.nonfood.forEach(x=>spN+=x.i);
      g.extra.forEach(x=>spE+=x.i);
      g.acconti.forEach(x=>acc+=x.i);
      inc+=g.inc;

      days+=`
      <div class="day-card">
        <div class="day-header" onclick="toggle(document.getElementById('d${mi}_${i}'))">
          ${formattaData(g.data)} <span>‚Ç¨ ${g.inc}</span>
        </div>
        <div class="day-body" id="d${mi}_${i}">
          ${blocco("Food",g.food)}
          ${blocco("Non Food",g.nonfood)}
          ${blocco("Extra",g.extra)}
          ${blocco("Acconti",g.acconti)}
        </div>
      </div>`;
    });

    let spTot=spF+spN+spE;
    html+=`
    <div class="month-card">
      <div class="month-header" onclick="toggle(document.getElementById('m${mi}'))">
        ${m} ‚Äî Inc ‚Ç¨${inc} | Sp ‚Ç¨${spTot} | Acc ‚Ç¨${acc}
      </div>
      <div class="month-body" id="m${mi}">${days}</div>
    </div>`;
  });
  storico.innerHTML=html;
}

function formattaData(d){
  let x=new Date(d);
  return `${String(x.getDate()).padStart(2,'0')}/${String(x.getMonth()+1).padStart(2,'0')}/${x.getFullYear()}`
}
mostraStorico();
</script>
</body>
</html>
