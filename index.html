<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Rosso Dorato Asproni</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#111;color:#fff;font-family:Arial;padding:20px}
h1,h2,h3{text-align:center}
.card{background:#1e1e1e;padding:15px;border-radius:10px;margin-bottom:20px}
input,select,button{width:100%;padding:10px;margin:4px 0;border-radius:6px;border:none}
button{background:#b30000;color:#fff;font-weight:bold}
.row{border:1px solid #333;padding:8px;margin-top:6px;border-radius:6px}
.small{font-size:14px;color:#ccc}
</style>
</head>

<body>

<h1>üç∑ Rosso Dorato Asproni</h1>

<div class="card">
<h2>Inserisci giornata</h2>

<input type="date" id="data">

<input type="number" placeholder="Incassi contanti" id="incC">
<input type="number" placeholder="Incassi POS" id="incP">
<input type="number" placeholder="Satispay" id="incS">

<h3>Spese food</h3>
<div id="food"></div>
<button onclick="add('food')">‚ûï Aggiungi food</button>

<h3>Spese non food</h3>
<div id="nonfood"></div>
<button onclick="add('nonfood')">‚ûï Aggiungi non food</button>

<h3>Extra personale</h3>
<div id="extra"></div>
<button onclick="add('extra')">‚ûï Aggiungi extra</button>

<h3>Acconti al personale</h3>
<div id="acconti"></div>
<button onclick="add('acconti')">‚ûï Aggiungi acconto</button>

<button onclick="salva()">üíæ Salva giornata</button>
</div>

<div class="card">
<h2>Storico (mese)</h2>
<select id="mese" onchange="storico()"></select>
<p id="totali"></p>
<div id="dettagli"></div>
</div>

<button onclick="export()">üì§ Esporta dati</button>

<script>
let dati = JSON.parse(localStorage.getItem("rd")) || {}

function riga(nome){
return `
<div class="row">
<input type="number" placeholder="Importo">
<input type="text" placeholder="${nome}">
<select>
<option>Contanti</option>
<option>POS</option>
<option>Bonifico</option>
</select>
</div>`
}

function add(id){
let placeholder = (id==="acconti") ? "Nome dipendente" : "Nome fornitore / persona"
document.getElementById(id).innerHTML += riga(placeholder)
}

['food','nonfood','extra','acconti'].forEach(add)

function salva(){
let d = data.value
if(!d) return alert("Inserisci la data")
let m = d.slice(0,7)
if(!dati[m]) dati[m]=[]

function leggi(id){
let arr=[]
document.querySelectorAll(`#${id} .row`).forEach(r=>{
let i=+r.children[0].value||0
let n=r.children[1].value
let p=r.children[2].value
if(i>0) arr.push({i,n,p})
})
return arr
}

dati[m].push({
data:d,
inc:+incC.value + +incP.value + +incS.value,
food:leggi("food"),
nonfood:leggi("nonfood"),
extra:leggi("extra"),
acconti:leggi("acconti")
})

localStorage.setItem("rd",JSON.stringify(dati))
alert("Giornata salvata ‚úÖ")
mesi()
}

function mesi(){
mese.innerHTML=""
for(let m in dati)mese.innerHTML += `<option>${m}</option>`
storico()
}

function storico(){
let m = mese.value
if(!m) return

let inc=0,sp=0,acc=0,map={}

dati[m].forEach(g=>{
inc+=g.inc

[g.food,g.nonfood,g.extra].flat().forEach(s=>{
sp+=s.i
if(s.n) map[s.n]=(map[s.n]||0)+s.i
})

g.acconti.forEach(a=>{
acc+=a.i
if(a.n) map["Acconto "+a.n]=(map["Acconto "+a.n]||0)+a.i
})
})

totali.innerText =
`Incassi ‚Ç¨${inc} ‚Äì Spese ‚Ç¨${sp} ‚Äì Acconti personale ‚Ç¨${acc} ‚Äì Utile ‚Ç¨${inc-sp}`

dettagli.innerHTML=""
for(let k in map)
dettagli.innerHTML += `<div class="small">${k}: ‚Ç¨${map[k]}</div>`
}

function export(){
let a=document.createElement("a")
a.href="data:text/json,"+encodeURIComponent(JSON.stringify(dati,null,2))
a.download="rosso_dorato.json"
a.click()
}

mesi()
</script>

</body>
</html>
