<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Rosso Dorato Asproni</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#111;color:#fff;font-family:Arial;padding:20px}
h1,h2,h3{text-align:center}
.card{background:#1e1e1e;padding:15px;border-radius:10px;margin-bottom:20px}
input,select,button{width:100%;padding:10px;margin:4px 0;border-radius:6px;border:none}
button{background:#b30000;color:#fff;font-weight:bold}
.small{font-size:14px;color:#ccc}
.list{border:1px solid #333;padding:6px;margin:4px 0;border-radius:6px}
.list button{width:auto;margin-left:5px;background:#333}
.modal{display:none;position:fixed;top:0;left:0;width:100%;height:100%;
background:rgba(0,0,0,.8);align-items:center;justify-content:center;z-index:10}
.modalContent{background:#1e1e1e;padding:15px;border-radius:10px;width:90%;max-width:400px}
</style>
</head>

<body>

<h1>üç∑ Rosso Dorato Asproni</h1>

<div class="card">
<h2>Inserisci giornata</h2>

<input type="date" id="data">
<input type="number" placeholder="Incassi contanti" id="incC">
<input type="number" placeholder="Incassi POS" id="incP">
<input type="number" placeholder="Satispay" id="incS">

<h3>Inserimenti</h3>
<button onclick="openModal('food')">‚ûï Food</button>
<button onclick="openModal('nonfood')">‚ûï Non food</button>
<button onclick="openModal('extra')">‚ûï Extra</button>
<button onclick="openModal('acconti')">‚ûï Acconto personale</button>

<button onclick="salva()">üíæ Salva giornata</button>
</div>

<div class="card">
<h2>Storico mese</h2>
<select id="mese" onchange="storico()"></select>
<p id="totali"></p>
<div id="dettagli"></div>
</div>

<!-- MODALE -->
<div class="modal" id="modal">
<div class="modalContent">
<h3 id="titolo"></h3>

<input type="number" id="mImporto" placeholder="Importo">
<input type="text" id="mNome" placeholder="Nome">
<select id="mPag">
<option>Contanti</option>
<option>POS</option>
<option>Bonifico</option>
</select>

<button onclick="saveVoice()">Salva voce</button>

<div id="lista"></div>

<button onclick="closeModal()">Chiudi</button>
</div>
</div>

<script>
let dati=JSON.parse(localStorage.getItem("rd"))||{}
let buffer={food:[],nonfood:[],extra:[],acconti:[]}
let corrente=""

function openModal(tipo){
corrente=tipo
titolo.innerText="Gestione "+tipo
modal.style.display="flex"
renderLista()
}

function closeModal(){modal.style.display="none"}

function saveVoice(){
let i=+mImporto.value||0
if(i<=0)return alert("Importo mancante")
buffer[corrente].push({i,n:mNome.value,p:mPag.value})
mImporto.value=""; mNome.value=""
renderLista()
}

function renderLista(){
lista.innerHTML=""
buffer[corrente].forEach((v,idx)=>{
lista.innerHTML+=`
<div class="list">
‚Ç¨${v.i} - ${v.n}
<button onclick="edit(${idx})">‚úèÔ∏è</button>
<button onclick="del(${idx})">‚ùå</button>
</div>`
})
}

function edit(i){
mImporto.value=buffer[corrente][i].i
mNome.value=buffer[corrente][i].n
buffer[corrente].splice(i,1)
renderLista()
}

function del(i){
buffer[corrente].splice(i,1)
renderLista()
}

function salva(){
let d=data.value
if(!d)return alert("Inserisci data")
let m=d.slice(0,7)
if(!dati[m])dati[m]=[]

dati[m].push({
data:d,
inc:+incC.value + +incP.value + +incS.value,
food:buffer.food,
nonfood:buffer.nonfood,
extra:buffer.extra,
acconti:buffer.acconti
})

localStorage.setItem("rd",JSON.stringify(dati))
backupAutomatico()

alert("Giornata salvata ‚úÖ")
buffer={food:[],nonfood:[],extra:[],acconti:[]}
aggiornaMesi()
}

function backupAutomatico(){
let oggi=new Date().toISOString().slice(0,10)
let a=document.createElement("a")
a.href="data:text/json,"+encodeURIComponent(JSON.stringify(dati,null,2))
a.download=`backup-rosso-dorato-${oggi}.json`
a.click()
}

function aggiornaMesi(){
mese.innerHTML=""
for(let m in dati)mese.innerHTML+=`<option>${m}</option>`
storico()
}

function storico(){
let m=mese.value
if(!m)return
let inc=0,sp=0,acc=0,map={}

dati[m].forEach(g=>{
inc+=g.inc
;[...g.food,...g.nonfood,...g.extra].forEach(s=>{
sp+=s.i; if(s.n)map[s.n]=(map[s.n]||0)+s.i
})
g.acconti.forEach(a=>{
acc+=a.i; map["Acconto "+a.n]=(map["Acconto "+a.n]||0)+a.i
})
})

totali.innerText=
`Incassi ‚Ç¨${inc} ‚Äì Spese ‚Ç¨${sp} ‚Äì Acconti ‚Ç¨${acc} ‚Äì Utile ‚Ç¨${inc-sp}`

dettagli.innerHTML=""
for(let k in map)dettagli.innerHTML+=`<div class="small">${k}: ‚Ç¨${map[k]}</div>`
}

aggiornaMesi()
</script>

</body>
</html>
