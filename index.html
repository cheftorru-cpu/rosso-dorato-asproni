<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçÖ Rosso Dorato - COMPLETO PRO</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { font-family: -apple-system, sans-serif; background: linear-gradient(135deg, #ff6b6b, #4ecdc4); min-height: 100vh; padding: 15px; }
        .container { max-width: 950px; margin: 0 auto; background: white; border-radius: 20px; box-shadow: 0 20px 40px rgba(0,0,0,0.2); overflow: hidden; }
        .header { background: #ff6b6b; color: white; padding: 25px; text-align: center; }
        .tabs { display: flex; background: #f8f9fa; flex-wrap: wrap; }
        .tab { flex: 1; min-width: 140px; padding: 20px; text-align: center; cursor: pointer; border-bottom: 4px solid transparent; font-weight: bold; }
        .tab.active { background: white; border-bottom-color: #ff6b6b; }
        .tab-content { display: none; padding: 25px; }
        .tab-content.active { display: block; }
        .input-row { display: grid; grid-template-columns: 2fr 1fr 1fr 1fr; gap: 10px; margin: 15px 0; }
        .input-row-2 { grid-template-columns: 1fr 1fr; }
        input, select { padding: 15px; border: 2px solid #ddd; border-radius: 10px; font-size: 16px; }
        input:focus { border-color: #4ecdc4; outline: none; }
        button { background: #4ecdc4; color: white; border: none; padding: 15px 20px; border-radius: 10px; font-size: 16px; cursor: pointer; font-weight: bold; }
        button:hover { background: #45b7aa; }
        .item { background: #f8f9fa; padding: 20px; margin: 15px 0; border-radius: 12px; display: flex; justify-content: space-between; align-items: center; font-size: 16px; }
        .item button { background: #ff6b6b; padding: 10px 15px; font-size: 14px; min-width: 80px; margin-left: 5px; }
        .item button.edit { background: #ffc107; }
        .posticipato { background: #fff3cd !important; border-left: 5px solid #ffc107; }
        .acconto { background: #e3f2fd !important; border-left: 5px solid #2196f3; }
        .saldato { background: #d4edda !important; border-left: 5px solid #28a745; }
        .scorta-bassa { background: #ffebee !important; border-left: 5px solid #f44336; animation: pulse 2s infinite; }
        @keyframes pulse { 0% { box-shadow: 0 0 0 0 rgba(244,67,54,0.7); } 70% { box-shadow: 0 0 0 10px rgba(244,67,54,0); } 100% { box-shadow: 0 0 0 0 rgba(244,67,54,0); } }
        .stats { display: grid; grid-template-columns: repeat(auto-fit, minmax(180px, 1fr)); gap: 15px; margin: 30px 0; }
        .stat { background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: white; padding: 20px; border-radius: 15px; text-align: center; font-size: 18px; font-weight: bold; }
        .alert { background: #ffebee; border: 2px solid #f44336; border-radius: 12px; padding: 20px; margin: 20px 0; text-align: center; font-weight: bold; color: #c62828; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { padding: 15px; text-align: left; border-bottom: 1px solid #ddd; }
        th { background: #ff6b6b; color: white; }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üçÖ Rosso Dorato PRO</h1>
            <p>Incassi ‚Ä¢ Magazzino Uso ‚Ä¢ Fatture Modificabili</p>
        </div>
        
        <div class="tabs">
            <div class="tab active" onclick="showTab('incassi')">üí∞ Incassi</div>
            <div class="tab" onclick="showTab('magazzino')">üì¶ Magazzino</div>
            <div class="tab" onclick="showTab('fatture')">üìÑ Fatture</div>
            <div class="tab" onclick="showTab('stats')">üìä Totale</div>
        </div>
        
        <div id="incassi" class="tab-content active">
            <h2>üí∞ Incassi Oggi</h2>
            <div class="input-row input-row-2">
                <input id="pos" type="number" step="0.01" placeholder="POS (‚Ç¨)">
                <input id="contanti" type="number" step="0.01" placeholder="Contanti (‚Ç¨)">
                <input id="sardex" type="number" step="0.01" placeholder="Sardex (cr)">
                <button onclick="addIncasso()">‚ûï SALVA</button>
            </div>
            <div id="listaIncassi"></div>
        </div>
        
        <div id="magazzino" class="tab-content">
            <h2>üì¶ Magazzino (Usa/Modifica)</h2>
            <div class="input-row">
                <input id="descMag" placeholder="Farina 00">
                <input id="qtaMag" type="number" placeholder="Kg/Lt">
                <input id="costoMag" type="number" step="0.01" placeholder="‚Ç¨">
                <select id="tipoMag">
                    <option value="food">üçó FOOD</option>
                    <option value="nonfood">üßº NON FOOD</option>
                </select>
                <button onclick="addMagazzino()">‚ûï NUOVO</button>
            </div>
            <div class="input-row">
                <input id="usaDesc" placeholder="Farina usata oggi">
                <input id="usaQta" type="number" step="0.1" placeholder="Kg usati">
                <button onclick="usaMagazzino()" style="grid-column: span 2">‚ûñ USA</button>
            </div>
            <div id="listaMagazzino"></div>
        </div>
        
        <div id="fatture" class="tab-content">
            <h2>üìÑ Fatture (Modifica Pagamento)</h2>
            <div class="input-row">
                <input id="fornitore" placeholder="Metro">
                <input id="importo" type="number" step="0.01" placeholder="‚Ç¨">
                <input id="dataFattura" type="date">
                <select id="statoFattura">
                    <option value="posticipato">‚è≥ POSTICIPATO</option>
                    <option value="acconto">üí≥ ACCONTO</option>
                    <option value="saldato">‚úÖ SALDATO</option>
                </select>
                <button onclick="addFattura()">‚ûï NUOVA</button>
            </div>
            <div id="listaFatture"></div>
        </div>
        
        <div id="stats" class="tab-content">
            <h2>üìä DASHBOARD</h2>
            <div id="alertScorte"></div>
            <div class="stats">
                <div class="stat">Incassi Oggi<br><span id="totIncassiOggi">0‚Ç¨</span></div>
                <div class="stat">Food Spend<br><span id="totFood">0‚Ç¨</span></div>
                <div class="stat">Non Food<br><span id="totNonFood">0‚Ç¨</span></div>
                <div class="stat">Da Saldare<br><span id="daSaldare">0‚Ç¨</span></div>
            </div>
        </div>
    </div>

    <script>
        let incassi = JSON.parse(localStorage.getItem('incassiRD')) || [];
        let magazzino = JSON.parse(localStorage.getItem('magazzinoRD')) || [];
        let fatture = JSON.parse(localStorage.getItem('fattureRD')) || [];
        
        function showTab(tab) {
            document.querySelectorAll('.tab-content').forEach(c => c.classList.remove('active'));
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
            updateDisplay();
        }
        
        function addIncasso() {
            const pos = parseFloat(document.getElementById('pos').value) || 0;
            const contanti = parseFloat(document.getElementById('contanti').value) || 0;
            const sardex = parseFloat(document.getElementById('sardex').value) || 0;
            const totale = pos + contanti;
            if (totale > 0) {
                const data = new Date().toLocaleDateString('it-IT');
                incassi.unshift({data, pos, contanti, sardex, totale});
                localStorage.setItem('incassiRD', JSON.stringify(incassi));
                document.getElementById('pos').value = '';
                document.getElementById('contanti').value = '';
                document.getElementById('sardex').value = '';
                updateIncassi();
            }
        }
        
        function addMagazzino() {
            const desc = document.getElementById('descMag').value;
            const qta = parseFloat(document.getElementById('qtaMag').value) || 0;
            const costo = parseFloat(document.getElementById('costoMag').value) || 0;
            const tipo = document.getElementById('tipoMag').value;
            if (desc && qta > 0 && costo > 0) {
                magazzino.push({desc, qta, resto: qta, costo, tipo, data: new Date().toLocaleDateString('it-IT')});
                localStorage.setItem('magazzinoRD', JSON.stringify(magazzino));
                document.getElementById('descMag').value = '';
                document.getElementById('qtaMag').value = '';
                document.getElementById('costoMag').value = '';
                updateMagazzino();
            }
        }
        
        function usaMagazzino() {
            const desc = document.getElementById('usaDesc').value;
            const qtaUsata = parseFloat(document.getElementById('usaQta').value) || 0;
            const item = magazzino.find(m => m.desc.toLowerCase() === desc.toLowerCase());
            if (item && qtaUsata > 0 && item.resto >= qtaUsata) {
                item.resto -= qtaUsata;
                item.costoGiornaliero = (item.costo / item.qta) * qtaUsata;
                localStorage.setItem('magazzinoRD', JSON.stringify(magazzino));
                document.getElementById('usaDesc').value = '';
                document.getElementById('usaQta').value = '';
                updateMagazzino();
            }
        }
        
        function modificaFattura(index) {
            const stati = ['posticipato', 'acconto', 'saldato'];
            const statoAttuale = fatture[index].stato;
            const prossimo = stati[(stati.indexOf(statoAttuale) + 1) % 3];
            fatture[index].stato = prossimo;
            localStorage.setElement('fattureRD', JSON.stringify(fatture));
            updateFatture();
        }
        
        function addFattura() {
            const fornitore = document.getElementById('fornitore').value;
            const importo = parseFloat(document.getElementById('importo').value) || 0;
            const data = document.getElementById('dataFattura').value || new Date().toISOString().split('T')[0];
            const stato = document.getElementById('statoFattura').value;
            if (fornitore && importo > 0) {
                fatture.push({fornitore, importo, data, stato});
                localStorage.setItem('fattureRD', JSON.stringify(fatture));
                document.getElementById('fornitore').value = '';
                document.getElementById('importo').value = '';
                document.getElementById('dataFattura').value = '';
                updateFatture();
            }
        }
        
        function updateIncassi() {
            const lista = document.getElementById('listaIncassi');
            lista.innerHTML = incassi.slice(0,8).map((inc, i) => 
                `<div class="item">
                    <div>${inc.data}: POS ${inc.pos.toFixed(0)}‚Ç¨ + Contanti ${inc.contanti.toFixed(0)}‚Ç¨ = <strong>${inc.totale.toFixed(0)}‚Ç¨</strong></div>
                    <button onclick="removeIncasso(${i})">üóëÔ∏è</button>
                </div>`
            ).join('');
        }
        
        function updateMagazzino() {
            const lista = document.getElementById('listaMagazzino');
            const scorteBasse = magazzino.filter(m => m.resto <= 5 && m.tipo === 'food');
            lista.innerHTML = magazzino.slice(-10).reverse().map((item, i) => {
                const className = item.resto <= 5 && item.tipo === 'food' ? 'scorta-bassa' : '';
                return `<div class="item ${className}">
                    <div>
                        <div style="font-weight:bold">${item.desc}</div>
                        <div>${item.resto.toFixed(1)}/${item.qta} ${item.tipo === 'food' ? 'üçó' : 'üßº'} ${item.costo.toFixed(0)}‚Ç¨ tot</div>
                        ${item.costoGiornaliero ? `<div style="color:#f44336">Oggi usato: ${item.costoGiornaliero.toFixed(1)}‚Ç¨</div>` : ''}
                    </div>
                    <div>
                        <button class="edit" onclick="modificaMagazzino(${magazzino.length - 1 - i})">‚úèÔ∏è</button>
                        <button onclick="removeMagazzino(${magazzino.length - 1 - i})">üóëÔ∏è</button>
                    </div>
                </div>`;
            }).join('');
        }
        
        function updateFatture() {
            const lista = document.getElementById('listaFatture');
            lista.innerHTML = fatture.slice(-10).reverse().map((f, i) => 
                `<div class="item ${f.stato}">
                    <div>
                        <div style="font-weight:bold">${f.fornitore}</div>
                        <div>${f.importo.toFixed(2)}‚Ç¨ - ${f.data}</div>
                    </div>
                    <div>
                        <button class="edit" onclick="modificaFattura(${fatture.length - 1 - i})">‚û°Ô∏è ${f.stato.toUpperCase()}</button>
                        <button onclick="removeFattura(${fatture.length - 1 - i})">üóëÔ∏è</button>
                    </div>
                </div>`
            ).join('');
        }
        
        function updateDisplay() {
            const oggi = new Date().toLocaleDateString('it-IT');
            const oggiIncasso = incassi.find(i => i.data === oggi);
            const totIncassiOggi = oggiIncasso ? oggiIncasso.totale : 0;
            
            const foodTot = magazzino.filter(m => m.tipo === 'food').reduce((sum, m) => sum + m.costo, 0);
            const nonfoodTot = magazzino.filter(m => m.tipo === 'nonfood').reduce((sum, m) => sum + m.costo, 0);
            const daSaldare = fatture.filter(f => f.stato !== 'saldato').reduce((sum, f) => sum + f.importo, 0);
            
            document.getElementById('totIncassiOggi').textContent = totIncassiOggi.toFixed(0) + '‚Ç¨';
            document.getElementById('totFood').textContent = foodTot.toFixed(0) + '‚Ç¨';
            document.getElementById('totNonFood').textContent = nonfoodTot.toFixed(0) + '‚Ç¨';
            document.getElementById('daSaldare').textContent = daSaldare.toFixed(0) + '‚Ç¨';
            
            // Alert scorte
            const scorteBasse = magazzino.filter(m => m.resto <= 5 && m.tipo === 'food');
            document.getElementById('alertScorte').innerHTML = scorteBasse.length > 0 ? 
                `<div class="alert">üö® SCORTE CRITICHE: ${scorteBasse.map(s => s.desc).join(', ')} (${scorteBasse.map(s => s.resto.toFixed(1) + 'kg').join(', ')})</div>` : '';
        }
        
        function removeIncasso(i) { incassi.splice(i,1); localStorage.setItem('incassiRD', JSON.stringify(incassi)); updateIncassi(); updateDisplay(); }
        function removeMagazzino(i) { magazzino.splice(i,1); localStorage.setItem('magazzinoRD', JSON.stringify(magazzino)); updateMagazzino(); updateDisplay(); }
        function removeFattura(i) { fatture.splice(i,1); localStorage.setItem('fattureRD', JSON.stringify(fatture)); updateFatture(); updateDisplay(); }
        function modificaMagazzino(i) { alert('Modifica: ' + magazzino[i].desc + ' resto ' + magazzino[i].resto + 'kg'); }
        function modificaFattura(i) { /* Gi√† gestito sopra */ }
        
        document.getElementById('dataFattura').value = new Date().toISOString().split('T')[0];
        updateIncassi(); updateMagazzino(); updateFatture(); updateDisplay();
    </script>
</body>
</html>
