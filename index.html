<!DOCTYPE html>
<html lang="it">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>üçÖ Tomato AI - Rosso Dorato</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body { 
            font-family: -apple-system, BlinkMacSystemFont, sans-serif; 
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh; padding: 20px;
        }
        .app { max-width: 1200px; margin: 0 auto; }
        .header { 
            background: rgba(255,255,255,0.95); backdrop-filter: blur(20px);
            padding: 30px; border-radius: 24px; text-align: center; margin-bottom: 30px;
            box-shadow: 0 25px 50px rgba(0,0,0,0.15);
        }
        .ai-card { 
            background: rgba(255,255,255,0.9); border-radius: 20px; padding: 25px; margin: 20px 0;
            box-shadow: 0 15px 35px rgba(0,0,0,0.1); border-left: 5px solid #ff6b6b;
        }
        .grid { display: grid; grid-template-columns: repeat(auto-fit, minmax(350px, 1fr)); gap: 20px; }
        input { width: 100%; padding: 15px; border: 2px solid #e9ecef; border-radius: 12px; font-size: 16px; margin: 8px 0; }
        input:focus { border-color: #4ecdc4; outline: none; box-shadow: 0 0 0 3px rgba(78,205,196,0.1); }
        button { 
            background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: white; border: none; 
            padding: 15px 30px; border-radius: 12px; font-size: 16px; font-weight: 600; 
            cursor: pointer; transition: all 0.3s; margin: 5px;
        }
        button:hover { transform: translateY(-2px); box-shadow: 0 10px 25px rgba(255,107,107,0.4); }
        .metric { 
            background: linear-gradient(135deg, #4ecdc4, #44a08d); color: white; 
            padding: 20px; border-radius: 16px; text-align: center; font-size: 24px; font-weight: bold;
        }
        .alert { background: #fff3cd; border: 2px solid #ffc107; border-radius: 12px; padding: 15px; margin: 15px 0; }
        .prediction { font-size: 28px; font-weight: bold; color: #ff6b6b; }
        table { width: 100%; border-collapse: collapse; margin: 20px 0; background: white; border-radius: 12px; overflow: hidden; box-shadow: 0 10px 25px rgba(0,0,0,0.1); }
        th { background: linear-gradient(135deg, #ff6b6b, #ff8e8e); color: white; padding: 15px; text-align: left; }
        td { padding: 15px; border-bottom: 1px solid #f0f0f0; }
        .profit { color: #27ae60; font-weight: bold; }
        .loss { color: #e74c3c; font-weight: bold; }
    </style>
</head>
<body>
    <div class="app">
        <div class="header">
            <h1>üçÖ Tomato AI - Rosso Dorato</h1>
            <p>AI che prevede incassi, controlla costi e avvisa scorte</p>
        </div>

        <div class="grid">
            <div class="ai-card">
                <h3>üí∞ Registra Incasso Oggi</h3>
                <input id="incassoTotale" type="number" step="0.01" placeholder="Incasso totale oggi (‚Ç¨)">
                <div style="display:grid;grid-template-columns:1fr 1fr;gap:10px">
                    <input id="pos" type="number" step="0.01" placeholder="POS (‚Ç¨)">
                    <input id="contanti" type="number" step="0.01" placeholder="Contanti (‚Ç¨)">
                    <input id="sardex" type="number" step="0.01" placeholder="Sardex (cr)">
                </div>
                <button onclick="registraIncasso()">üöÄ Registra & Prevedi</button>
                <div id="previsioneAI" style="margin-top:20px"></div>
            </div>

            <div class="ai-card">
                <h3>üì¶ Magazzino Critico</h3>
                <input id="prodotto" placeholder="Farina 00">
                <input id="quantita" type="number" placeholder="Kg rimanenti">
                <input id="prezzoKg" type="number" step="0.01" placeholder="‚Ç¨/Kg">
                <button onclick="aggiungiMagazzino()">‚ûï Aggiungi</button>
                <div id="magazzinoLista"></div>
            </div>

            <div class="ai-card">
                <h3>üë®‚Äçüç≥ Ricetta & Margine</h3>
                <input id="nomeRicetta" placeholder="Pizza Margherita">
                <input id="costoRicetta" type="number" step="0.01" placeholder="Costo materie (‚Ç¨)">
                <input id="prezzoVendita" type="number" step="0.01" placeholder="Prezzo vendita (‚Ç¨)">
                <button onclick="calcolaMargine()">üí° Calcola AI</button>
                <div id="margineRisultato"></div>
            </div>
        </div>

        <div class="ai-card">
            <h2>üìä Dashboard AI Live</h2>
            <div style="display:grid;grid-template-columns:repeat(auto-fit,minmax(250px,1fr));gap:20px;margin:20px 0">
                <div class="metric" id="incassiOggi">0‚Ç¨</div>
                <div class="metric" id="previsioneDomani">0‚Ç¨</div>
                <div class="metric" id="valoreMagazzino">0‚Ç¨</div>
                <div class="metric" id="profittoNetto">0‚Ç¨</div>
            </div>
            <div id="alertAI"></div>
            <table>
                <thead><tr><th>Data</th><th>Incasso</th><th>POS</th><th>Contanti</th><th>Sardex</th><th>AI Previsione</th></tr></thead>
                <tbody id="storicoIncassi"></tbody>
            </table>
        </div>
    </div>

    <script>
        let dati = JSON.parse(localStorage.getItem('tomatoAI')) || {incassi:[], magazzino:[], ricette:[]};
        let previsioneMedia = 0;

        function salvaDati() {
            localStorage.setItem('tomatoAI', JSON.stringify(dati));
        }

        function registraIncasso() {
            const totale = parseFloat(document.getElementById('incassoTotale').value) || 0;
            const pos = parseFloat(document.getElementById('pos').value) || 0;
            const contanti = parseFloat(document.getElementById('contanti').value) || 0;
            const sardex = parseFloat(document.getElementById('sardex').value) || 0;
            
            if (totale > 0) {
                const data = new Date().toLocaleDateString('it-IT');
                const record = {data, totale, pos, contanti, sardex};
                dati.incassi.unshift(record); // Pi√π recenti prima
                salvaDati();
                aggiornaDashboard();
                
                // AI Previsione semplice (media ultimi 7 giorni)
                const ultimi7 = dati.incassi.slice(0,7);
                previsioneMedia = ultimi7.reduce((sum, i) => sum + i.totale, 0) / ultimi7.length;
                document.getElementById('previsioneAI').innerHTML = 
                    `<div class="prediction">ü§ñ Domani: ${previsioneMedia.toFixed(0)}‚Ç¨</div>
                     <small>(Media ultimi ${ultimi7.length} giorni)</small>`;
                
                document.getElementById('incassoTotale').value = '';
                document.getElementById('pos').value = '';
                document.getElementById('contanti').value = '';
                document.getElementById('sardex').value = '';
            }
        }

        function aggiungiMagazzino() {
            const prodotto = document.getElementById('prodotto').value;
            const quantita = parseFloat(document.getElementById('quantita').value);
            const prezzoKg = parseFloat(document.getElementById('prezzoKg').value);
            if (prodotto && quantita && prezzoKg) {
                dati.magazzino.push({prodotto, quantita, prezzoKg, valore: quantita*prezzoKg});
                salvaDati();
                document.getElementById('prodotto').value = '';
                document.getElementById('quantita').value = '';
                document.getElementById('prezzoKg').value = '';
                aggiornaDashboard();
            }
        }

        function calcolaMargine() {
            const costo = parseFloat(document.getElementById('costoRicetta').value);
            const vendita = parseFloat(document.getElementById('prezzoVendita').value);
            if (costo && vendita) {
                const margine = ((vendita - costo) / vendita * 100).toFixed(1);
                const ok = margine >= 70 ? '‚úÖ OTTIMO' : margine >= 60 ? '‚ö†Ô∏è OK' : '‚ùå BASSO';
                document.getElementById('margineRisultato').innerHTML = 
                    `<div style="font-size:22px;font-weight:bold;color:${margine>=70?'#27ae60':'#e74c3c'}">
                        ${ok} ${margine}% (${(vendita-costo).toFixed(2)}‚Ç¨)
                    </div>`;
                dati.ricette.push({
                    nome: document.getElementById('nomeRicetta').value,
                    margine: parseFloat(margine),
                    profitto: vendita - costo
                });
                salvaDati();
                document.getElementById('nomeRicetta').value = '';
                document.getElementById('costoRicetta').value = '';
                document.getElementById('prezzoVendita').value = '';
            }
        }

        function aggiornaDashboard() {
            // Incassi oggi
            const oggi = new Date().toLocaleDateString('it-IT');
            const oggiIncasso = dati.incassi.find(i => i.data === oggi);
            document.getElementById('incassiOggi').textContent = oggiIncasso ? `${oggiIncasso.totale.toFixed(0)}‚Ç¨` : '0‚Ç¨';

            // Previsione domani
            document.getElementById('previsioneDomani').textContent = `${previsioneMedia.toFixed(0)}‚Ç¨`;

            // Valore magazzino
            const valoreMagazzino = dati.magazzino.reduce((sum, m) => sum + m.valore, 0);
            document.getElementById('valoreMagazzino').textContent = `${valoreMagazzino.toFixed(0)}‚Ç¨`;

            // Profitto netto ricette
            const profittoRicette = dati.ricette.reduce((sum, r) => sum + r.profitto, 0);
            document.getElementById('profittoNetto').textContent = `${profittoRicette.toFixed(0)}‚Ç¨`;

            // Storico tabella
            document.getElementById('storicoIncassi').innerHTML = dati.incassi.slice(0,10).map(i => 
                `<tr>
                    <td>${i.data}</td>
                    <td>${i.totale.toFixed(0)}‚Ç¨</td>
                    <td>${i.pos.toFixed(0)}‚Ç¨</td>
                    <td>${i.contanti.toFixed(0)}‚Ç¨</td>
                    <td>${i.sardex}cr</td>
                    <td>${(previsioneMedia * 0.9).toFixed(0)}‚Ç¨</td>
                </tr>`
            ).join('');

            // Alert AI
            let alertHTML = '';
            const scorteBasse = dati.magazzino.filter(m => m.quantita < 5);
            if (scorteBasse.length > 0) {
                alertHTML += `<div class="alert">‚ö†Ô∏è ${scorteBasse.length} scorte sotto 5kg: ${scorteBasse.map(s=>s.prodotto).join(', ')}</div>`;
            }
            if (previsioneMedia > 800) {
                alertHTML += `<div class="alert">üöÄ AI: Domani incassi record! ${previsioneMedia.toFixed(0)}‚Ç¨</div>`;
            }
            document.getElementById('alertAI').innerHTML = alertHTML;
        }

        aggiornaDashboard();
    </script>
</body>
</html>
