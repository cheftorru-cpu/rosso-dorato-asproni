<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<title>Rosso Dorato Asproni</title>

<style>
body{font-family:Arial;background:#f7f7f7;padding:10px}
h1{text-align:center}
.box{background:#fff;padding:10px;margin-bottom:15px;border-radius:8px}
input,select,button{width:100%;padding:8px;margin:5px 0}
button{background:#b30000;color:#fff;border:none;border-radius:5px}
.day{border-bottom:1px solid #ddd;padding:6px}
.small{font-size:12px;color:#555}
.total{font-weight:bold;margin-top:10px}
</style>
</head>

<body>

<h1>üç∑ Rosso Dorato Asproni</h1>

<div class="box">
<h2>Inserisci giornata</h2>

<input type="date" id="data">

<input type="number" id="contanti" placeholder="Incassi contanti">
<input type="number" id="pos" placeholder="Incassi POS">
<input type="number" id="satis" placeholder="Satispay">

<input type="number" id="food" placeholder="Spese food">
<input id="fornFood" placeholder="Fornitore food">

<input type="number" id="nonfood" placeholder="Spese non food">
<input id="fornNon" placeholder="Fornitore non food">

<input type="number" id="extra" placeholder="Extra personale">

<button onclick="salva()">üíæ Salva giornata</button>
</div>

<div class="box">
<h2>Storico</h2>
<select id="meseSelect" onchange="aggiorna()"></select>

<div id="lista"></div>
<div id="totaleMese" class="total"></div>
</div>

<div class="box">
<h2>Spese per fornitore</h2>
<div id="fornitori"></div>
</div>

<div class="box">
<button onclick="exportCSV()">üì§ Esporta dati</button>
</div>

<script>
let dati = JSON.parse(localStorage.getItem("dati")) || [];

function mesiDisponibili(){
 let mesi=[...new Set(dati.map(d=>d.data.slice(0,7)))].sort().reverse();
 meseSelect.innerHTML=mesi.map(m=>`<option value="${m}">${m}</option>`).join("");
 if(!meseSelect.value && mesi.length) meseSelect.value=mesi[0];
}

function salva(){
 if(!data.value) return alert("Seleziona la data");
 if(dati.find(d=>d.data==data.value)) return alert("Giorno gi√† inserito");

 dati.push({
  data:data.value,
  cont:+contanti.value||0,
  pos:+pos.value||0,
  sat:+satis.value||0,
  food:+food.value||0,
  ffood:fornFood.value,
  non:+nonfood.value||0,
  fnon:fornNon.value,
  extra:+extra.value||0
 });

 localStorage.setItem("dati", JSON.stringify(dati));
 mesiDisponibili();
 aggiorna();
}

function aggiorna(){
 let mese=meseSelect.value;
 let incT=0, spT=0;
 let forn={};

 lista.innerHTML = dati
 .filter(d=>d.data.startsWith(mese))
 .sort((a,b)=>b.data.localeCompare(a.data))
 .map(g=>{
  let inc=g.cont+g.pos+g.sat;
  let sp=g.food+g.non+g.extra;
  incT+=inc; spT+=sp;

  if(g.ffood) forn[g.ffood]=(forn[g.ffood]||0)+g.food;
  if(g.fnon) forn[g.fnon]=(forn[g.fnon]||0)+g.non;

  return `
  <div class="day">
   <b>${g.data}</b><br>
   Incassi ${inc}‚Ç¨ ‚Äì Spese ${sp}‚Ç¨ ‚Äì Utile ${inc-sp}‚Ç¨
   <div class="small">
    Food ${g.food}‚Ç¨ (${g.ffood||"-"})<br>
    Non food ${g.non}‚Ç¨ (${g.fnon||"-"})
   </div>
  </div>`;
 }).join("");

 totaleMese.innerHTML =
  `Totale mese: Incassi ${incT}‚Ç¨ ‚Äì Spese ${spT}‚Ç¨ ‚Äì Utile ${incT-spT}‚Ç¨`;

 fornitori.innerHTML = Object.keys(forn).length
 ? Object.entries(forn).map(f=>`<div class="day">${f[0]} ‚Üí ${f[1]}‚Ç¨</div>`).join("")
 : "Nessuna spesa";
}

function exportCSV(){
 let csv="Data,Contanti,POS,Satispay,Food,FornFood,NonFood,FornNon,Extra\n";
 dati.forEach(g=>{
  csv+=`${g.data},${g.cont},${g.pos},${g.sat},${g.food},${g.ffood},${g.non},${g.fnon},${g.extra}\n`;
 });
 let a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([csv],{type:"text/csv"}));
 a.download="rosso_dorato.csv";
 a.click();
}

mesiDisponibili();
aggiorna();
</script>

</body>
</html>
