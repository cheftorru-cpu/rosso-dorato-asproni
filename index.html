<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Rosso Dorato â€“ Gestionale</title>
<style>
body{font-family:Arial;background:#f7f7f7;padding:15px}
h1{color:#8b0000}
.box{background:#fff;padding:15px;border-radius:8px;margin-bottom:15px}
input,select{width:100%;padding:8px;margin-top:6px}
button{width:100%;padding:10px;margin-top:8px;border:none;border-radius:6px;font-size:16px}
.salva{background:#8b0000;color:#fff}
.chiudi{background:#333;color:#fff}
.mag{background:#555;color:#fff}
.exp{background:#006400;color:#fff}
.item{background:#eee;padding:8px;margin-top:6px;border-radius:5px}
</style>
</head>

<body>

<h1>Rosso Dorato â€“ Gestionale</h1>

ðŸ“… Data:
<input type="date" id="dataScelta">

<div class="box">
<h3>Incassi</h3>
<input id="contanti" type="number" placeholder="Contanti">
<input id="pos" type="number" placeholder="POS">
<input id="satis" type="number" placeholder="Satispay">
</div>

<div class="box">
<h3>Spese</h3>
<input id="food" type="number" placeholder="Food">
<input id="nonfood" type="number" placeholder="Non food">
<input id="personale" type="number" placeholder="Extra personale">
</div>

<button class="salva" onclick="salvaGiornata()">ðŸ’¾ Salva giornata</button>
<button class="chiudi" onclick="chiudiMese()">ðŸŸ¥ Chiudi mese</button>
<button class="exp" onclick="exportGiorni()">ðŸ“¤ Esporta giornate</button>

<div class="box">
Incassi: <span id="inc">0</span> â‚¬<br>
Spese: <span id="spe">0</span> â‚¬<br>
Utile: <span id="uti">0</span> â‚¬
</div>

<div class="box">
<h2>ðŸ“¦ Magazzino</h2>
<input id="nome" placeholder="Prodotto">
<input id="qta" type="number" placeholder="QuantitÃ ">
<select id="tipo">
<option>Food</option>
<option>Bevande</option>
<option>Materiale</option>
</select>
<button class="mag" onclick="carico()">âž• Carico</button>
<button class="mag" onclick="scarico()">âž– Scarico</button>
<button class="exp" onclick="exportMagazzino()">ðŸ“¤ Esporta magazzino</button>
<div id="listaMag"></div>
</div>

<script>
dataScelta.value=new Date().toISOString().split("T")[0];
let giorni=JSON.parse(localStorage.getItem("giorni"))||[];
let mag=JSON.parse(localStorage.getItem("magazzino"))||[];

function salvaGiornata(){
 let d=new Date(dataScelta.value).toLocaleDateString("it-IT");
 if(giorni.some(g=>g.d===d)){alert("Giornata giÃ  inserita");return;}
 let inc=+contanti.value + +pos.value + +satis.value;
 let spe=+food.value + +nonfood.value + +personale.value;
 giorni.push({d,inc,spe,uti:inc-spe});
 localStorage.setItem("giorni",JSON.stringify(giorni));
 aggiorna();
}

function chiudiMese(){
 if(!confirm("Chiudere il mese?"))return;
 giorni=[];
 localStorage.setItem("giorni","[]");
 aggiorna();
}

function carico(){
 let p=mag.find(m=>m.n===nome.value && m.t===tipo.value);
 if(p)p.q+=+qta.value;
 else mag.push({n:nome.value,t:tipo.value,q:+qta.value});
 salvaMag();
}

function scarico(){
 let p=mag.find(m=>m.n===nome.value && m.t===tipo.value);
 if(p){p.q-=+qta.value;if(p.q<0)p.q=0;}
 salvaMag();
}

function salvaMag(){
 localStorage.setItem("magazzino",JSON.stringify(mag));
 aggiorna();
}

function exportGiorni(){
 let csv="Data,Incassi,Spese,Utile\n";
 giorni.forEach(g=>csv+=`${g.d},${g.inc},${g.spe},${g.uti}\n`);
 scarica(csv,"giornate.csv");
}

function exportMagazzino(){
 let csv="Prodotto,Categoria,QuantitÃ \n";
 mag.forEach(m=>csv+=`${m.n},${m.t},${m.q}\n`);
 scarica(csv,"magazzino.csv");
}

function scarica(testo,nome){
 let a=document.createElement("a");
 a.href=URL.createObjectURL(new Blob([testo],{type:"text/csv"}));
 a.download=nome;
 a.click();
}

function aggiorna(){
 let i=0,s=0,u=0,h="";
 giorni.forEach(g=>{i+=g.inc;s+=g.spe;u+=g.uti});
 inc.innerText=i; spe.innerText=s; uti.innerText=u;
 mag.forEach(m=>h+=`<div class="item">${m.n} (${m.t}) â€“ ${m.q}</div>`);
 listaMag.innerHTML=h;
}
aggiorna();
</script>

</body>
</html>
