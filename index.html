<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Rosso Dorato Asproni</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#111;color:#fff;font-family:Arial;padding:20px}
h1,h2,h3{text-align:center}
.card{background:#1e1e1e;padding:15px;border-radius:10px;margin-bottom:20px}
input,select,button{width:100%;padding:10px;margin:4px 0;border-radius:6px;border:none}
button{background:#b30000;color:#fff;font-weight:bold}
.small{font-size:14px;color:#ccc}

/* MODALE */
.modal{
display:none;
position:fixed;
top:0;left:0;
width:100%;height:100%;
background:rgba(0,0,0,.8);
align-items:center;
justify-content:center;
z-index:10
}
.modalContent{
background:#1e1e1e;
padding:15px;
border-radius:10px;
width:90%;
max-width:400px
}
</style>
</head>

<body>

<h1>üç∑ Rosso Dorato Asproni</h1>

<div class="card">
<h2>Inserisci giornata</h2>

<input type="date" id="data">

<input type="number" placeholder="Incassi contanti" id="incC">
<input type="number" placeholder="Incassi POS" id="incP">
<input type="number" placeholder="Satispay" id="incS">

<h3>Spese food</h3>
<button onclick="openModal('food')">‚ûï Aggiungi food</button>

<h3>Spese non food</h3>
<button onclick="openModal('nonfood')">‚ûï Aggiungi non food</button>

<h3>Extra personale</h3>
<button onclick="openModal('extra')">‚ûï Aggiungi extra</button>

<h3>Acconti al personale</h3>
<button onclick="openModal('acconti')">‚ûï Aggiungi acconto</button>

<button onclick="salva()">üíæ Salva giornata</button>
</div>

<div class="card">
<h2>Storico (mese)</h2>
<select id="mese" onchange="storico()"></select>
<p id="totali"></p>
<div id="dettagli"></div>
</div>

<button onclick="exportData()">üì§ Esporta dati</button>

<!-- MODALE -->
<div class="modal" id="modal">
<div class="modalContent">
<h3 id="modalTitle"></h3>
<input type="number" id="mImporto" placeholder="Importo">
<input type="text" id="mNome" placeholder="Nome">
<select id="mPag">
<option>Contanti</option>
<option>POS</option>
<option>Bonifico</option>
</select>
<button onclick="saveModal()">Salva voce</button>
<button onclick="closeModal()">Annulla</button>
</div>
</div>

<script>
let dati=JSON.parse(localStorage.getItem("rd"))||{}
let buffer={food:[],nonfood:[],extra:[],acconti:[]}
let tipoCorrente=""

function openModal(tipo){
tipoCorrente=tipo
modal.style.display="flex"
modalTitle.innerText="Aggiungi "+tipo
mImporto.value=""
mNome.value=""
}

function closeModal(){
modal.style.display="none"
}

function saveModal(){
let i=+mImporto.value||0
if(i<=0)return alert("Importo mancante")
buffer[tipoCorrente].push({i,n:mNome.value,p:mPag.value})
closeModal()
}

function salva(){
let d=data.value
if(!d)return alert("Inserisci data")
let m=d.slice(0,7)
if(!dati[m])dati[m]=[]

dati[m].push({
data:d,
inc:+incC.value + +incP.value + +incS.value,
food:buffer.food,
nonfood:buffer.nonfood,
extra:buffer.extra,
acconti:buffer.acconti
})

buffer={food:[],nonfood:[],extra:[],acconti:[]}
localStorage.setItem("rd",JSON.stringify(dati))
alert("Giornata salvata ‚úÖ")
aggiornaMesi()
}

function aggiornaMesi(){
mese.innerHTML=""
for(let m in dati)mese.innerHTML+=`<option>${m}</option>`
storico()
}

function storico(){
let m=mese.value
if(!m)return
let inc=0,sp=0,acc=0,map={}

dati[m].forEach(g=>{
inc+=g.inc
;[...g.food,...g.nonfood,...g.extra].forEach(s=>{
sp+=s.i
if(s.n)map[s.n]=(map[s.n]||0)+s.i
})
g.acconti.forEach(a=>{
acc+=a.i
map["Acconto "+a.n]=(map["Acconto "+a.n]||0)+a.i
})
})

totali.innerText=`Incassi ‚Ç¨${inc} ‚Äì Spese ‚Ç¨${sp} ‚Äì Acconti ‚Ç¨${acc} ‚Äì Utile ‚Ç¨${inc-sp}`
dettagli.innerHTML=""
for(let k in map)dettagli.innerHTML+=`<div class="small">${k}: ‚Ç¨${map[k]}</div>`
}

function exportData(){
let a=document.createElement("a")
a.href="data:text/json,"+encodeURIComponent(JSON.stringify(dati,null,2))
a.download="rosso_dorato.json"
a.click()
}

aggiornaMesi()
</script>

</body>
</html>
