<!DOCTYPE html>
<html lang="it">
<head>
<meta charset="UTF-8">
<title>Rosso Dorato Asproni</title>
<meta name="viewport" content="width=device-width, initial-scale=1">
<style>
body{background:#111;color:#eee;font-family:system-ui;padding:15px}
h1{text-align:center}
h2{margin-top:25px}
.card{background:#1c1c1c;border-radius:12px;padding:15px;margin-bottom:15px}
.day{border:1px solid #333;border-radius:10px;padding:10px;margin:8px 0}
.row{display:flex;justify-content:space-between;align-items:center}
.trash{background:#333;border:none;border-radius:6px;padding:4px 8px;font-size:12px}
.small{color:#bbb;font-size:14px}
input,button{width:100%;padding:10px;margin:5px 0;border-radius:8px;border:none}
button{background:#b11218;color:#fff;font-weight:600}
</style>
</head>

<body>

<h1>üç∑ Rosso Dorato Asproni</h1>

<div class="card">
<h2>Nuova giornata</h2>
<input type="date" id="data">
<input type="number" placeholder="Incassi contanti" id="incC">
<input type="number" placeholder="Incassi POS" id="incP">
<input type="number" placeholder="Sardex" id="incS">
<button onclick="salva()">üíæ Salva giornata</button>
</div>

<div class="card">
<h2>Storico</h2>
<div id="storico"></div>
</div>

<script>
let db = JSON.parse(localStorage.getItem("rd")) || {};

function salva() {
  if (!data.value) return alert("Inserisci la data");
  let mese = data.value.slice(0,7);
  if (!db[mese]) db[mese] = [];
  db[mese].push({
    data: data.value,
    inc: (+incC.value||0)+(+incP.value||0)+(+incS.value||0)
  });
  localStorage.setItem("rd", JSON.stringify(db));
  backup();
  caricaStorico();
  alert("Salvato ‚úÖ");
}

function caricaStorico() {
  storico.innerHTML = "";
  let mesi = Object.keys(db).sort().reverse();
  mesi.forEach(m=>{
    let titolo = document.createElement("h2");
    titolo.innerText = m;
    storico.appendChild(titolo);

    db[m].slice().reverse().forEach((g,i)=>{
      let d = document.createElement("div");
      d.className="day";
      d.innerHTML=`
        <div class="row">
          <strong>${g.data}</strong>
          <button class="trash" onclick="delG('${m}',${db[m].length-1-i})">üóë</button>
        </div>
        <div class="small">Incassi ‚Ç¨${g.inc}</div>`;
      storico.appendChild(d);
    });
  });
}

function delG(m,i){
  if(!confirm("Eliminare giornata?"))return;
  db[m].splice(i,1);
  if(db[m].length==0) delete db[m];
  localStorage.setItem("rd", JSON.stringify(db));
  backup();
  caricaStorico();
}

function backup(){
  let a=document.createElement("a");
  a.href="data:text/json,"+encodeURIComponent(JSON.stringify(db));
  a.download="backup-rosso-dorato.json";
  a.click();
}

caricaStorico();
</script>

</body>
</html>
